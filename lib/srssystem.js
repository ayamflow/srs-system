!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t||self).srsSystem={})}(this,function(t){function e(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}var i=0;function n(t){return"__private_"+i+++"_"+t}function s(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}function o(t){return Array.isArray(t)?t:[t]}var a=n("stages"),u=n("computeStage"),h=function(){function t(t){if(void 0===t&&(t={}),Object.defineProperty(this,a,{writable:!0,value:void 0}),Object.defineProperty(this,u,{writable:!0,value:void 0}),!t.computeStage)throw new Error("A `computeStage` method must be provided");if(!t.stages)throw new Error("An array of `stages` must be provided");t.stages.forEach(function(t){if(null==t.interval)throw new Error("Each member of `stages` has to have a .interval property")}),this.cards=t.cards||[],s(this,a)[a]=t.stages,s(this,u)[u]=t.computeStage}var e=t.prototype;return e.getCards=function(){var t=Date.now();return this.cards.filter(function(e){return e.enabled&&e.timestamp<t})},e.getTimeline=function(t,e){void 0===t&&(t=Date.now()),void 0===e&&(e=-1);var r=this.cards.filter(function(r){return e>-1?(e=Math.min(e,6048e5),r.enabled&&r.timestamp>=t&&r.timestamp<=e):r.enabled&&r.timestamp>=t});r.sort(function(t,e){return e.timestamp<t.timestamp});var i=[];return r.forEach(function(t){var e,r,n,s=(e=t.timestamp,r=new Date(Date.now()),n=new Date(e),(e-Date.now())/1e3/60/60<24?r.getDate()==n.getDate()?0:1:n.getDay()),o=function(t){return new Date(t).getHours()}(t.timestamp);i[s]=i[s]||[],i[s][o]=i[s][o]||[],i[s][o].push(t)}),i.forEach(function(t,e){i[e]=t.filter(function(t){return null!=t})}),i=i.filter(function(t){return null!=t})},e.update=function(t){t.stage=s(this,u)[u](t),t.stage=Math.min(t.stage,s(this,a)[a].length-1),t.stage=Math.max(t.stage,1),t.timestamp=Date.now()+s(this,a)[a][t.stage].interval},e.toJSON=function(){return{cards:this.cards.map(function(t){return t.toJSON()})}},e.fromJSON=function(t){this.cards=t.cards.map(function(t){(new Card).fromJSON(t)})},t}(),c=n("timestamp"),f=n("wrongAnswersCount"),d=n("rightAnswersCount"),l=n("stage"),p=n("frontSide"),g=n("backSide"),w=n("enabled"),v=function(){function t(t,e){Object.defineProperty(this,c,{writable:!0,value:void 0}),Object.defineProperty(this,f,{writable:!0,value:void 0}),Object.defineProperty(this,d,{writable:!0,value:void 0}),Object.defineProperty(this,l,{writable:!0,value:void 0}),Object.defineProperty(this,p,{writable:!0,value:void 0}),Object.defineProperty(this,g,{writable:!0,value:void 0}),Object.defineProperty(this,w,{writable:!0,value:void 0}),s(this,p)[p]=o(t),s(this,g)[g]=o(e),this.reset()}var e=t.prototype;return e.fromJSON=function(t){s(this,p)[p]=t.frontSide,s(this,g)[g]=t.backSide,s(this,d)[d]=t.rightAnswersCount,s(this,f)[f]=t.wrongAnswersCount,s(this,c)[c]=t.timestamp,s(this,l)[l]=t.stage,s(this,w)[w]=t.enabled},e.toJSON=function(){return{frontSide:s(this,p)[p],backSide:s(this,g)[g],rightAnswersCount:s(this,d)[d],wrongAnswersCount:s(this,f)[f],timestamp:s(this,c)[c],stage:s(this,l)[l],enabled:s(this,w)[w]}},e.checkAnswer=function(t,e){return e?this.checkFrontSide(t):this.checkBackSide(t)},e.checkFrontSide=function(t){return s(this,p)[p].reduce(function(e,r){return t.toLowerCase()==r.toLowerCase()||e},!1)},e.checkBackSide=function(t){return s(this,g)[g].reduce(function(e,r){return t.toLowerCase()==r.toLowerCase()||e},!1)},e.answer=function(t){t?s(this,d)[d]++:s(this,f)[f]++},e.reset=function(){s(this,c)[c]=-1,s(this,f)[f]=0,s(this,d)[d]=0,s(this,l)[l]=0,s(this,w)[w]=!1},e.enable=function(){this.reset(),s(this,l)[l]=1,s(this,w)[w]=!0},r(t,[{key:"stage",set:function(t){s(this,l)[l]=t},get:function(){return s(this,l)[l]}},{key:"frontSide",get:function(){return s(this,p)[p]}},{key:"backSide",get:function(){return s(this,g)[g]}},{key:"wrongAnswersCount",get:function(){return s(this,f)[f]}},{key:"rightAnswersCount",get:function(){return s(this,d)[d]}},{key:"timestamp",set:function(t){s(this,c)[c]=t},get:function(){return s(this,c)[c]}},{key:"enabled",get:function(){return s(this,w)[w]}}]),t}(),m=n("cards"),b=n("scheduler"),y=n("current"),S=n("questions"),k=function(){function t(t){Object.defineProperty(this,m,{writable:!0,value:void 0}),Object.defineProperty(this,b,{writable:!0,value:void 0}),Object.defineProperty(this,y,{writable:!0,value:void 0}),Object.defineProperty(this,S,{writable:!0,value:void 0}),s(this,m)[m]=t.getCards(),s(this,b)[b]=t,s(this,S)[S]=function(t){for(var e=t.length;0!==e;){var r=Math.floor(Math.random()*e),i=t[e-=1];t[e]=t[r],t[r]=i}return t}(s(this,m)[m].map(function(t){var e=t.frontSide.join(", "),r=t.backSide.join(", ");return[{side:e,isFrontSide:!0,errored:!1,card:t},{side:r,isFrontSide:!1,errored:!1,card:t}]}).flat())}var e=t.prototype;return e.getNext=function(){return s(this,y)[y]=s(this,S)[S].shift(),s(this,y)[y]},e.answer=function(t){var e=s(this,y)[y],r=e.card.checkAnswer(t,e.isFrontSide);return r?(s(this,y)[y].card.answer(r),s(this,b)[b].update(s(this,y)[y].card)):(s(this,S)[S].push(s(this,y)[y]),s(this,y)[y].errored||(s(this,y)[y].errored=!0,s(this,y)[y].card.answer(r))),r},r(t,[{key:"length",get:function(){return 2*s(this,m)[m].length}},{key:"done",get:function(){return this.length-s(this,S)[S].length+(s(this,y)[y]?-1:0)}},{key:"cards",get:function(){return s(this,m)[m]}}]),t}();t.Card=v,t.Review=k,t.Scheduler=h});
