!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t||self).srsSystem={})}(this,function(t){function e(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}var n=0;function i(t){return"__private_"+n+++"_"+t}function o(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}function s(t){return Array.isArray(t)?t:[t]}function a(t){return t[Math.floor(Math.random()*t.length)]}var u=i("stages"),h=i("computeStage"),c=function(){function t(t){if(void 0===t&&(t={}),Object.defineProperty(this,u,{writable:!0,value:void 0}),Object.defineProperty(this,h,{writable:!0,value:void 0}),!t.computeStage)throw new Error("A `computeStage` method must be provided");if(!t.stages)throw new Error("An array of `stages` must be provided");t.stages.forEach(function(t){if(null==t.interval)throw new Error("Each member of `stages` has to have a .interval property")}),this.cards=t.cards||[],o(this,u)[u]=t.stages,o(this,h)[h]=t.computeStage}var e=t.prototype;return e.getCards=function(){var t=Date.now();return this.cards.filter(function(e){return e.enabled&&e.timestamp<t})},e.getTimeline=function(t,e){void 0===t&&(t=Date.now()),void 0===e&&(e=-1);var r=this.cards.filter(function(r){return e>-1?(e=Math.min(e,6048e5),r.enabled&&r.timestamp>=t&&r.timestamp<=e):r.enabled&&r.timestamp>=t});r.sort(function(t,e){return e.timestamp<t.timestamp});var n=[];return r.forEach(function(t){var e,r,i,o=(e=t.timestamp,r=new Date(Date.now()),i=new Date(e),(e-Date.now())/1e3/60/60<24?r.getDate()==i.getDate()?0:1:i.getDay()),s=function(t){return new Date(t).getHours()}(t.timestamp);n[o]=n[o]||[],n[o][s]=n[o][s]||[],n[o][s].push(t)}),n.forEach(function(t,e){n[e]=t.filter(function(t){return null!=t})}),n=n.filter(function(t){return null!=t})},e.update=function(t){t.stage=o(this,h)[h](t),t.stage=Math.min(t.stage,o(this,u)[u].length-1),t.stage=Math.max(t.stage,1),t.timestamp=Date.now()+o(this,u)[u][t.stage].interval},e.toJSON=function(){return{cards:this.cards.map(function(t){return t.toJSON()})}},e.fromJSON=function(t){this.cards=t.cards.map(function(t){(new Card).fromJSON(t)})},t}(),f=i("timestamp"),d=i("wrongAnswersCount"),l=i("rightAnswersCount"),p=i("stage"),g=i("frontSide"),w=i("backSide"),m=i("enabled"),v=function(){function t(t,e){Object.defineProperty(this,f,{writable:!0,value:void 0}),Object.defineProperty(this,d,{writable:!0,value:void 0}),Object.defineProperty(this,l,{writable:!0,value:void 0}),Object.defineProperty(this,p,{writable:!0,value:void 0}),Object.defineProperty(this,g,{writable:!0,value:void 0}),Object.defineProperty(this,w,{writable:!0,value:void 0}),Object.defineProperty(this,m,{writable:!0,value:void 0}),o(this,g)[g]=s(t),o(this,w)[w]=s(e),this.reset()}var e=t.prototype;return e.fromJSON=function(t){o(this,g)[g]=t.frontSide,o(this,w)[w]=t.backSide,o(this,l)[l]=t.rightAnswersCount,o(this,d)[d]=t.wrongAnswersCount,o(this,f)[f]=t.timestamp,o(this,p)[p]=t.stage,o(this,m)[m]=t.enabled},e.toJSON=function(){return{frontSide:o(this,g)[g],backSide:o(this,w)[w],rightAnswersCount:o(this,l)[l],wrongAnswersCount:o(this,d)[d],timestamp:o(this,f)[f],stage:o(this,p)[p],enabled:o(this,m)[m]}},e.checkAnswer=function(t,e){return e?this.checkFrontSide(t):this.checkBackSide(t)},e.checkFrontSide=function(t){return o(this,g)[g].reduce(function(e,r){return t.toLowerCase()==r.toLowerCase()||e},!1)},e.checkBackSide=function(t){return o(this,w)[w].reduce(function(e,r){return t.toLowerCase()==r.toLowerCase()||e},!1)},e.answer=function(t){t?o(this,l)[l]++:o(this,d)[d]++},e.reset=function(){o(this,f)[f]=-1,o(this,d)[d]=0,o(this,l)[l]=0,o(this,p)[p]=0,o(this,m)[m]=!1},e.enable=function(){this.reset(),o(this,p)[p]=1,o(this,m)[m]=!0},r(t,[{key:"stage",set:function(t){o(this,p)[p]=t},get:function(){return o(this,p)[p]}},{key:"frontSide",get:function(){return o(this,g)[g]}},{key:"backSide",get:function(){return o(this,w)[w]}},{key:"wrongAnswersCount",get:function(){return o(this,d)[d]}},{key:"rightAnswersCount",get:function(){return o(this,l)[l]}},{key:"timestamp",set:function(t){o(this,f)[f]=t},get:function(){return o(this,f)[f]}},{key:"enabled",get:function(){return o(this,m)[m]}}]),t}(),b=i("scheduler"),y=i("current"),S=i("questions"),k=i("length"),O=function(){function t(t){Object.defineProperty(this,b,{writable:!0,value:void 0}),Object.defineProperty(this,y,{writable:!0,value:void 0}),Object.defineProperty(this,S,{writable:!0,value:void 0}),Object.defineProperty(this,k,{writable:!0,value:void 0}),o(this,b)[b]=t,o(this,S)[S]=function(t){for(var e=t.length;0!==e;){var r=Math.floor(Math.random()*e),n=t[e-=1];t[e]=t[r],t[r]=n}return t}(t.getCards().map(function(t){return[{side:a(t.frontSide),isFrontSide:!0,errored:!1,card:t},{side:a(t.backSide),isFrontSide:!1,errored:!1,card:t}]}).flat()),o(this,k)[k]=o(this,S)[S].length}var e=t.prototype;return e.getNext=function(){return o(this,y)[y]=o(this,S)[S].shift(),o(this,y)[y]},e.answer=function(t){var e=o(this,y)[y],r=e.card.checkAnswer(t,e.isFrontSide);return r?(o(this,y)[y].card.answer(r),o(this,b)[b].update(o(this,y)[y].card)):(o(this,S)[S].push(o(this,y)[y]),o(this,y)[y].errored||(o(this,y)[y].errored=!0,o(this,y)[y].card.answer(r))),r},r(t,[{key:"length",get:function(){return o(this,k)[k]}},{key:"done",get:function(){return this.length-o(this,S)[S].length+(o(this,y)[y]?-1:0)}}]),t}();t.Card=v,t.Review=O,t.Scheduler=c});
